<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Who's that SuperGM?</title>
  <meta name="description" content="Guess the SuperGM.">
  <meta name="author" content="Philipp Otto">

  <script src="/assets/htmx.min.js"></script>
  <script src="/assets/htmx-response-targets.js"></script>
  <link rel="stylesheet" href="/assets/game.css">

  <script>
    var currentGameId = 1337;

    function generateGameId() {
      currentGameId = Math.floor(Math.random() * 16777215);
      return currentGameId;
    }

    function getGameId() {
      return currentGameId;
    }

    function getCurrentName() {
      var submitElement = document.getElementById("answerBox");
      if (!submitElement) {
        return "";
      }
      return submitElement.value;
    }

    function copyPrediction() {
      var submitElement = document.getElementById("answerBox");
      var predictionElement = document.getElementById("predictionBox");
      if (submitElement && predictionElement) {
        submitElement.value = predictionElement.value;
      }
    }

    htmx.on("keydown", function (evt) {
      console.log(evt);

      if (evt.key === 'Tab') {
        copyPrediction();
        evt.preventDefault();
        evt.stopPropagation();
      }
    });
  </script>
</head>

<body>
  <div class="flexparentrow container">
    <div class="left-chessboard"></div>
    <div class="background">
      {% if start_screen %}

      <div class="flexparentcol playarea">
        <h1>Who's that SuperGM?</h1>

        <div class="explanation">
          <p>Every few seconds, you will get additional information about a 2700+ chess player.
            Try to find out who it is as fast as you can.</p>
          <p>‚ôüÔ∏è ‚ôüÔ∏è ‚ôüÔ∏è</p>
          <p>Good luck and have fun! </p>
        </div>
        <button class="button" hx-get="/start_game" hx-vals='js:{"game_id": generateGameId()}' hx-target="body"
          hx-swap="outerHTML">Play</button>
      </div>

      {% else %}

      {% include 'playarea' %}

      {% endif %}

      <div class="flexparentcol bottom">

        {% if not start_screen %}
        <div class="dummy" style="display: none;"></div>

        {% include 'prediction' %}

        <form class="flexparentrow editparent" autocomplete="off" hx-get="/answer" hx-target=".background"
          hx-target-418=".dummy" hx-vals='js:{"game_id": getGameId(), "name": getCurrentName()}'>

          <input type="text" class="textedit" id="answerBox" autocomplete="off" autofocus hx-get="/prediction"
            hx-target="#prediction" hx-trigger="input delay:0.1s" hx-swap="outerHTML"
            hx-vals='js:{"game_id": getGameId(), "name": getCurrentName()}'></input>

          <button type="submit" class="button">Submit</button>

        </form>
        {% endif %}

        <div class="footer">
          ¬© Philipp Otto 2023 - Created with
          <a href="https://www.rust-lang.org/" target=‚Äù_blank‚Äù>Rust</a>
          and
          <a href="https://htmx.org/" target=‚Äù_blank‚Äù>htmx</a>
          ‚ù§Ô∏è Hosted by
          <a href="https://fly.io/" target=‚Äù_blank‚Äù>fly.io</a>
          üöÄ
        </div>
      </div>
    </div>
    <div class="right-chessboard"></div>
  </div>
</body>

</html>